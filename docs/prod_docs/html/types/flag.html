<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Switches" href="switch.html" /><link rel="prev" title="Types" href="index.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2023.09.10 -->
        <title>Flags - django-waffle 4.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">django-waffle 4.1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">django-waffle 4.1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about/why-waffle.html">Why Waffle?</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../starting/index.html">Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Getting Started</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../starting/requirements.html">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../starting/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../starting/upgrading.html">Upgrading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../starting/configuring.html">Configuring Waffle</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Types</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Types</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="switch.html">Switches</a></li>
<li class="toctree-l2"><a class="reference internal" href="sample.html">Samples</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../usage/index.html">Using Waffle</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Using Waffle</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../usage/views.html">Using Waffle in views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/decorators.html">Decorating entire views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/mixins.html">Mixins for Class Based Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/templates.html">Using Waffle in templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/javascript.html">Using WaffleJS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/json.html">Waffle Status as JSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="../usage/cli.html">Managing Waffle data from the command line</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../testing/index.html">Testing with Waffle</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Testing with Waffle</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../testing/automated.html">Automated testing with Waffle</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/user.html">User testing with Waffle</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about/contributing.html">Contributing to Waffle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/goals.html">Waffle’s goals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/roadmap.html">Roadmap</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/django-waffle/django-waffle/edit/master/docs/types/flag.rst" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="flags">
<span id="types-flag"></span><h1>Flags<a class="headerlink" href="#flags" title="Link to this heading">#</a></h1>
<p>Flags are the most robust, flexible method of rolling out a feature with
Waffle. Flags can be used to enable a feature for specific users,
groups, users meeting certain criteria (such as being authenticated, or
superusers) or a certain percentage of visitors.</p>
<section id="how-flags-work">
<h2>How Flags Work<a class="headerlink" href="#how-flags-work" title="Link to this heading">#</a></h2>
<p>Flags compare the current <a class="reference external" href="https://docs.djangoproject.com/en/dev/topics/http/urls/#how-django-processes-a-request">request</a> to their criteria to decide whether
they are active. Consider this simple example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">flag_is_active</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../usage/views.html#usage-views"><span class="std std-ref">flag_is_active</span></a> function takes two arguments, the
request, and the name of a flag. Assuming this flag (<code class="docutils literal notranslate"><span class="pre">foo</span></code>) is defined
in the database, Waffle will make roughly the following decisions:</p>
<ul class="simple">
<li><p>Is <code class="docutils literal notranslate"><span class="pre">WAFFLE_OVERRIDE</span></code> active and if so does this request specify a
value for this flag? If so, use that value.</p></li>
<li><p>If not, is the flag set to globally on or off (the <em>Everyone</em>
setting)? If so, use that value.</p></li>
<li><p>If not, is the flag in <em>Testing</em> mode, and does the request specify a
value for this flag? If so, use that value and set a testing cookie.</p></li>
<li><p>If not, does the current user meet any of our criteria? If so, the
flag is active.</p></li>
<li><p>If not, does the user have an existing cookie set for this flag? If
so, use that value.</p></li>
<li><p>If not, randomly assign a value for this user based on the
<em>Percentage</em> and set a cookie.</p></li>
</ul>
</section>
<section id="flag-attributes">
<h2>Flag Attributes<a class="headerlink" href="#flag-attributes" title="Link to this heading">#</a></h2>
<p>Flags can be administered through the Django <a class="reference external" href="https://docs.djangoproject.com/en/dev/ref/contrib/admin/">admin site</a> or the
<a class="reference internal" href="../usage/cli.html#usage-cli"><span class="std std-ref">command line</span></a>. They have the following attributes:</p>
<dl class="field-list simple">
<dt class="field-odd">Name<span class="colon">:</span></dt>
<dd class="field-odd"><p>The name of the flag. Will be used to identify the flag everywhere.</p>
</dd>
<dt class="field-even">Everyone<span class="colon">:</span></dt>
<dd class="field-even"><p>Globally set the Flag, <strong>overriding all other criteria</strong>. Leave as
<em>Unknown</em> to use other criteria.</p>
</dd>
<dt class="field-odd">Testing<span class="colon">:</span></dt>
<dd class="field-odd"><p>Can the flag be specified via a querystring parameter? <a class="reference internal" href="#types-flag-testing"><span class="std std-ref">See
below</span></a>.</p>
</dd>
<dt class="field-even">Percent<span class="colon">:</span></dt>
<dd class="field-even"><p>A percentage of users for whom the flag will be active, if no other
criteria applies to them.</p>
</dd>
<dt class="field-odd">Superusers<span class="colon">:</span></dt>
<dd class="field-odd"><p>Is this flag always active for superusers?</p>
</dd>
<dt class="field-even">Staff<span class="colon">:</span></dt>
<dd class="field-even"><p>Is this flag always active for staff?</p>
</dd>
<dt class="field-odd">Authenticated<span class="colon">:</span></dt>
<dd class="field-odd"><p>Is this flag always active for authenticated users?</p>
</dd>
<dt class="field-even">Languages<span class="colon">:</span></dt>
<dd class="field-even"><p>Is the <code class="docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code> of the request in this list?
(Comma-separated values.)</p>
</dd>
<dt class="field-odd">Groups<span class="colon">:</span></dt>
<dd class="field-odd"><p>A list of group IDs for which this flag will always be active.</p>
</dd>
<dt class="field-even">Users<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of user IDs for which this flag will always be active.</p>
</dd>
<dt class="field-odd">Rollout<span class="colon">:</span></dt>
<dd class="field-odd"><p>Activate Rollout mode? <a class="reference internal" href="#types-flag-rollout"><span class="std std-ref">See below</span></a>.</p>
</dd>
<dt class="field-even">Note<span class="colon">:</span></dt>
<dd class="field-even"><p>Describe where the flag is used.</p>
</dd>
</dl>
<p>A Flag will be active if <em>any</em> of the criteria are true for the current
user or request (i.e. they are combined with <code class="docutils literal notranslate"><span class="pre">or</span></code>). For example, if a
Flag is active for superusers, a specific group, and 12% of visitors,
then it will be active if the current user is a superuser <em>or</em> if they
are in the group <em>or</em> if they are in the 12%.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Users are assigned randomly when using Percentages, so in practice
the actual proportion of users for whom the Flag is active will
probably differ slightly from the Percentage value.</p>
</div>
</section>
<section id="custom-flag-models">
<span id="types-flag-custom-model"></span><h2>Custom Flag Models<a class="headerlink" href="#custom-flag-models" title="Link to this heading">#</a></h2>
<p>For many cases, the default Flag model provides all the necessary functionality. It allows
flagging individual Users and Groups. If you would like flags to be applied to
different things, such as companies a User belongs to, you can use a custom flag model.</p>
<p>The functionality uses the same concepts as Django’s custom user models, and a lot of this will
be immediately recognizable.</p>
<p>An application needs to define a <code class="docutils literal notranslate"><span class="pre">WAFFLE_FLAG_MODEL</span></code> settings. The default is <code class="docutils literal notranslate"><span class="pre">waffle.Flag</span></code>
but can be pointed to an arbitrary object.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is not possible to change the Flag model and generate working migrations. Ideally, the flag
model should be defined at the start of a new project. This is a limitation of the <cite>swappable</cite>
Django magic. Please use magic responsibly.</p>
</div>
<p>The custom Flag model must inherit from <cite>waffle.models.AbstractBaseFlag</cite>. If you want the existing
<code class="docutils literal notranslate"><span class="pre">User</span></code> and <code class="docutils literal notranslate"><span class="pre">Group</span></code> based flagging and would like to add more entities to it,
you may extend <cite>waffle.models.AbstractUserFlag</cite>.</p>
<p>If you use a custom flag model to apply to models beyond Users and Groups, you must run Django’s
<code class="docutils literal notranslate"><span class="pre">makemigrations</span></code> before running migrations as outlined in the <a class="reference internal" href="../starting/installation.html#installation-settings-migrations"><span class="std std-ref">installation docs</span></a>.</p>
<p>If you need to reference the class that is being used as the <cite>Flag</cite> model in your project, use the
<code class="docutils literal notranslate"><span class="pre">get_waffle_flag_model()</span></code> method. If you reference the Flag a lot, it may be convenient to add
<code class="docutils literal notranslate"><span class="pre">Flag</span> <span class="pre">=</span> <span class="pre">get_waffle_flag_model()</span></code> right below your imports and reference the Flag model as if it had
been imported directly.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># settings.py</span>
<span class="n">WAFFLE_FLAG_MODEL</span> <span class="o">=</span> <span class="s1">&#39;myapp.Flag&#39;</span>

<span class="c1"># models.py</span>
<span class="kn">from</span> <span class="nn">waffle.models</span> <span class="kn">import</span> <span class="n">AbstractUserFlag</span><span class="p">,</span> <span class="n">CACHE_EMPTY</span>
<span class="kn">from</span> <span class="nn">waffle.utils</span> <span class="kn">import</span> <span class="n">get_setting</span><span class="p">,</span> <span class="n">keyfmt</span><span class="p">,</span> <span class="n">get_cache</span>

<span class="k">class</span> <span class="nc">Flag</span><span class="p">(</span><span class="n">AbstractUserFlag</span><span class="p">):</span>
    <span class="n">FLAG_COMPANIES_CACHE_KEY</span> <span class="o">=</span> <span class="s1">&#39;FLAG_COMPANIES_CACHE_KEY&#39;</span>
    <span class="n">FLAG_COMPANIES_CACHE_KEY_DEFAULT</span> <span class="o">=</span> <span class="s1">&#39;flag:</span><span class="si">%s</span><span class="s1">:companies&#39;</span>

    <span class="n">companies</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
        <span class="n">Company</span><span class="p">,</span>
        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Activate this flag for these companies.&#39;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_flush_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flush_keys</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">flush_keys</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Flag</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_flush_keys</span><span class="p">(</span><span class="n">flush_keys</span><span class="p">)</span>
        <span class="n">companies_cache_key</span> <span class="o">=</span> <span class="n">get_setting</span><span class="p">(</span><span class="n">Flag</span><span class="o">.</span><span class="n">FLAG_COMPANIES_CACHE_KEY</span><span class="p">,</span> <span class="n">Flag</span><span class="o">.</span><span class="n">FLAG_COMPANIES_CACHE_KEY_DEFAULT</span><span class="p">)</span>
        <span class="n">flush_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">keyfmt</span><span class="p">(</span><span class="n">companies_cache_key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">flush_keys</span>

    <span class="k">def</span> <span class="nf">is_active_for_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="n">is_active</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Flag</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">is_active_for_user</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_active</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">is_active</span>

        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">company_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_company_ids</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">company_id</span> <span class="ow">in</span> <span class="n">company_ids</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_get_company_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="n">get_cache</span><span class="p">()</span>
        <span class="n">cache_key</span> <span class="o">=</span> <span class="n">keyfmt</span><span class="p">(</span>
            <span class="n">get_setting</span><span class="p">(</span><span class="n">Flag</span><span class="o">.</span><span class="n">FLAG_COMPANIES_CACHE_KEY</span><span class="p">,</span> <span class="n">Flag</span><span class="o">.</span><span class="n">FLAG_COMPANIES_CACHE_KEY_DEFAULT</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="p">)</span>
        <span class="n">cached</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached</span> <span class="o">==</span> <span class="n">CACHE_EMPTY</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cached</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cached</span>

        <span class="n">company_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">companies</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s1">&#39;pk&#39;</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">company_ids</span><span class="p">:</span>
            <span class="n">cache</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">CACHE_EMPTY</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>

        <span class="n">cache</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">company_ids</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">company_ids</span>

<span class="c1"># admin.py</span>
<span class="kn">from</span> <span class="nn">waffle.admin</span> <span class="kn">import</span> <span class="n">FlagAdmin</span> <span class="k">as</span> <span class="n">WaffleFlagAdmin</span>

<span class="k">class</span> <span class="nc">FlagAdmin</span><span class="p">(</span><span class="n">WaffleFlagAdmin</span><span class="p">):</span>
    <span class="n">raw_id_fields</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">WaffleFlagAdmin</span><span class="o">.</span><span class="n">raw_id_fields</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;companies&#39;</span><span class="p">])</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Flag</span><span class="p">,</span> <span class="n">FlagAdmin</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="testing-mode">
<span id="types-flag-testing"></span><h2>Testing Mode<a class="headerlink" href="#testing-mode" title="Link to this heading">#</a></h2>
<p>See <a class="reference internal" href="../testing/user.html#testing-user"><span class="std std-ref">User testing with Waffle</span></a>.</p>
</section>
<section id="rollout-mode">
<span id="types-flag-rollout"></span><h2>Rollout Mode<a class="headerlink" href="#rollout-mode" title="Link to this heading">#</a></h2>
<p>When a Flag is activated by chance, Waffle sets a cookie so the flag
will not flip back and forth on subsequent visits. This can present a
problem for gradually deploying new features: users can get “stuck” with
the Flag turned off, even as the percentage increases.</p>
<p><em>Rollout mode</em> addresses this by changing the TTL of “off” cookies. When
Rollout mode is active, cookies setting the Flag to “off” are session
cookies, while those setting the Flag to “on” are still controlled by
<a class="reference internal" href="../starting/configuring.html#starting-configuring"><span class="std std-ref">WAFFLE_MAX_AGE</span></a>.</p>
<p>Effectively, Rollout mode changes the <em>Percentage</em> from “percentage of
visitors” to “percent chance that the Flag will be activated per visit.”</p>
</section>
<section id="auto-create-missing">
<span id="types-flag-auto-create-missing"></span><h2>Auto Create Missing<a class="headerlink" href="#auto-create-missing" title="Link to this heading">#</a></h2>
<p>When a flag is evaluated in code that is missing in the database the
flag returns the <a class="reference internal" href="../starting/configuring.html#starting-configuring"><span class="std std-ref">WAFFLE_FLAG_DEFAULT</span></a>
value but does not create a flag in the database. If you’d like waffle
to create missing flags in the database whenever it encounters a
missing flag you can set <a class="reference internal" href="../starting/configuring.html#starting-configuring"><span class="std std-ref">WAFFLE_CREATE_MISSING_FLAGS</span></a> to <code class="docutils literal notranslate"><span class="pre">True</span></code>. Missing flags will be created in
the database and the value of the <code class="docutils literal notranslate"><span class="pre">Everyone</span></code> flag attribute will be
set to <a class="reference internal" href="../starting/configuring.html#starting-configuring"><span class="std std-ref">WAFFLE_FLAG_DEFAULT</span></a> in the
auto-created database record.</p>
</section>
<section id="log-missing">
<span id="types-flag-log-missing"></span><h2>Log Missing<a class="headerlink" href="#log-missing" title="Link to this heading">#</a></h2>
<p>Whether or not you enabled <a class="reference internal" href="#types-flag-auto-create-missing"><span class="std std-ref">Auto Create Missing Flags</span></a>,
it can be practical to be informed that a flag was or is missing.
If you’d like waffle to log a warning, error, … you can set <a class="reference internal" href="../starting/configuring.html#starting-configuring"><span class="std std-ref">WAFFLE_LOG_MISSING_FLAGS</span></a> to any level known by Python default logger.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="switch.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Switches</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Types</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2012-2018, James Socol
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/django-waffle/django-waffle" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Flags</a><ul>
<li><a class="reference internal" href="#how-flags-work">How Flags Work</a></li>
<li><a class="reference internal" href="#flag-attributes">Flag Attributes</a></li>
<li><a class="reference internal" href="#custom-flag-models">Custom Flag Models</a></li>
<li><a class="reference internal" href="#testing-mode">Testing Mode</a></li>
<li><a class="reference internal" href="#rollout-mode">Rollout Mode</a></li>
<li><a class="reference internal" href="#auto-create-missing">Auto Create Missing</a></li>
<li><a class="reference internal" href="#log-missing">Log Missing</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=42d1b3bd"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>